# Migration `20200711164257-init`

This migration has been generated by softmarshmallow at 7/11/2020, 4:42:57 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "NotationType" AS ENUM ('DONT_KNOW', 'KNOW');

CREATE TYPE "UserType" AS ENUM ('STUDENT', 'ROBOT', 'ADMIN', 'TUTOR');

CREATE TABLE "public"."Word" (
"definitions" text []  ,
"domains" text []  ,
"examples" text []  ,
"id" SERIAL,
"metaId" text  NOT NULL ,
"shortDefinitions" text []  ,
"source" text  NOT NULL ,
"synonyms" text []  ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."WordMeta" (
"dictionaryId" integer  NOT NULL ,
"locale" text  NOT NULL ,
"token" text  NOT NULL ,
    PRIMARY KEY ("token"))

CREATE TABLE "public"."Dictionary" (
"authorId" integer  NOT NULL ,
"avatar" text   ,
"cover" text   ,
"description" text   ,
"id" SERIAL,
"name" text  NOT NULL ,
"public" boolean  NOT NULL DEFAULT false,
"url" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Profile" (
"avatar" text   ,
"bio" text   ,
"id" SERIAL,
"userId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."UserWordNotation" (
"id" SERIAL,
"type" "NotationType" NOT NULL ,
"userUid" integer   ,
"wordId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."User" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"email" text  NOT NULL ,
"name" text  NOT NULL ,
"sharedDictionaryId" integer   ,
"type" "UserType" NOT NULL ,
"uid" integer  NOT NULL ,
    PRIMARY KEY ("uid"))

CREATE  INDEX "metaId" ON "public"."Word"("metaId")

CREATE  INDEX "dictionaryId" ON "public"."WordMeta"("dictionaryId")

CREATE UNIQUE INDEX "Dictionary.url" ON "public"."Dictionary"("url")

CREATE  INDEX "authorId" ON "public"."Dictionary"("authorId")

CREATE UNIQUE INDEX "Profile.userId" ON "public"."Profile"("userId")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

ALTER TABLE "public"."Word" ADD FOREIGN KEY ("metaId")REFERENCES "public"."WordMeta"("token") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."WordMeta" ADD FOREIGN KEY ("dictionaryId")REFERENCES "public"."Dictionary"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Dictionary" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("uid") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("uid") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."UserWordNotation" ADD FOREIGN KEY ("wordId")REFERENCES "public"."WordMeta"("token") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."UserWordNotation" ADD FOREIGN KEY ("userUid")REFERENCES "public"."User"("uid") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("sharedDictionaryId")REFERENCES "public"."Dictionary"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200711164257-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,100 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource postgresql {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+// sense
+model Word {
+  id     Int      @default(autoincrement()) @id
+  // region meta
+  meta   WordMeta @relation(fields: [metaId], references: [token])
+  metaId String
+  @@index([metaId], name: "metaId")
+  // endregion meta
+  definitions      String[]
+  examples         String[]
+  shortDefinitions String[]
+  synonyms         String[]
+  domains          String[]
+  source           String
+}
+
+model WordMeta {
+  token        String     @id
+  locale       String
+  // region dictionary
+  dictionary   Dictionary @relation(fields: [dictionaryId], references: [id])
+  dictionaryId Int
+  @@index([dictionaryId], name: "dictionaryId")
+  // endregion dictionary
+  words     Word[]
+  notations UserWordNotation[] @relation("word")
+}
+
+model Dictionary {
+  id          Int     @default(autoincrement()) @id
+  name        String
+  description String?
+  cover       String?
+  avatar      String?
+  url         String  @unique
+  // region author
+  author      User    @relation(fields: [authorId], references: [uid], name: "author")
+  authorId    Int
+  @@index([authorId], name: "authorId")
+  // endregion author
+  words      WordMeta[]
+  sharedWith User[]     @relation("sharedWith")
+  public     Boolean    @default(false)
+}
+
+model Profile {
+  id     Int     @default(autoincrement()) @id
+  bio    String?
+  avatar String?
+  user   User    @relation(fields: [userId], references: [uid])
+  userId Int     @unique
+}
+
+enum NotationType {
+  DONT_KNOW
+  KNOW
+}
+
+model UserWordNotation {
+  id      Int          @default(autoincrement()) @id
+  word    WordMeta     @relation(fields: [wordId], references: [token], name: "word")
+  wordId  String
+  type    NotationType
+  User    User?        @relation(fields: [userUid], references: [uid])
+  userUid Int?
+}
+
+enum UserType {
+  STUDENT
+  ROBOT
+  ADMIN
+  TUTOR
+}
+
+model User {
+  uid                Int                @id
+  email              String             @unique
+  name               String
+  type               UserType
+  profile            Profile?
+  notions            UserWordNotation[]
+  // my dictionary
+  dictionaries       Dictionary[]       @relation("author")
+  // shared with me
+  sharedDictionary   Dictionary?        @relation(fields: [sharedDictionaryId], references: [id], name: "sharedWith")
+  sharedDictionaryId Int?
+  createdAt          DateTime           @default(now())
+}
```


